<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‘å¸ƒå…¬å‘Š - OAç³»ç»Ÿ</title>
    <link rel="stylesheet" href="../CSS/common.css">
    <link rel="stylesheet" href="../CSS/main.css">
    <style>
        .publish-container {
            padding: 20px;
        }
        
        .publish-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .publish-header h2 {
            margin: 0;
            color: #333;
            font-size: 20px;
        }
        
        .header-actions {
            display: flex;
            gap: 12px;
        }
        
        .btn-primary {
            background-color: #409EFF;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn-primary:hover {
            background-color: #66b1ff;
        }
        
        .btn-secondary {
            padding: 8px 16px;
            border: 1px solid #dcdfe6;
            background-color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn-secondary:hover {
            border-color: #409EFF;
            color: #409EFF;
        }
        
        .publish-form {
            background-color: white;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            padding: 24px;
        }
        
        .form-section {
            margin-bottom: 24px;
            width: 100%;
            box-sizing: border-box;
        }
        
        .form-section h3 {
            margin: 0 0 16px 0;
            color: #333;
            font-size: 16px;
            font-weight: 500;
        }
        
        .form-row {
            display: flex;
            gap: 24px;
            margin-bottom: 16px;
            width: 100%;
            box-sizing: border-box;
            padding: 0;
        }
        
        .form-item {
            flex: 1;
            min-width: 200px;
            box-sizing: border-box;
            padding: 0;
            margin: 0;
        }
        
        .form-item.full-width {
            flex: 100%;
            width: 100%;
            box-sizing: border-box;
            padding: 0;
            margin: 0;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #606266;
            font-weight: 500;
        }
        
        .form-label.required::after {
            content: '*';
            color: #f56c6c;
            margin-left: 4px;
        }
        
        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #dcdfe6;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: #409EFF;
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 120px;
        }
        
        .checkbox-group,
        .radio-group {
            display: flex;
            gap: 16px;
            align-items: center;
        }
        
        .checkbox-item,
        .radio-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            color: #606266;
        }
        
        .checkbox-item input[type="checkbox"],
        .radio-item input[type="radio"] {
            cursor: pointer;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 16px 0;
            border-top: 1px solid #ebeef5;
        }
        
        .tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-right: 8px;
            margin-bottom: 8px;
        }
        
        .tag.important {
            background-color: #fef0f0;
            color: #f56c6c;
        }
        
        .tag.top {
            background-color: #fdf6ec;
            color: #e6a23c;
        }
        
        /* é™„ä»¶ä¸Šä¼ åŒºåŸŸæ ·å¼ä¼˜åŒ– */
        .upload-wrapper {
            width: 100%;
            box-sizing: border-box;
        }
        
        .upload-placeholder {
            /* ä½¿ç”¨border-imageæ›¿ä»£ä¼ ç»Ÿdashedè¾¹æ¡†ï¼Œè§£å†³æ˜¾ç¤ºé—®é¢˜ */
            border: 1px solid transparent;
            border-radius: 8px;
            border-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='4' fill='none'%3E%3Cpath stroke='%23dcdfe6' stroke-width='3' d='M0 2h4M2 0v4'/%3E%3C/svg%3E") 1;
            padding: 30px 20px;
            text-align: center;
            background-color: #fafafa;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            box-sizing: border-box;
            display: block;
        }
        
        .upload-placeholder:hover {
            border-color: #409EFF;
            background-color: #f0f9ff;
            box-shadow: 0 2px 8px rgba(64, 158, 255, 0.1);
        }
        
        .upload-placeholder.dragover {
            border-color: #67c23a;
            background-color: #f0f9ff;
        }
        
        .form-item.full-width {
            flex: 100%;
            padding: 0;
            margin: 0;
        }
        
        .form-row {
            display: flex;
            gap: 24px;
            margin-bottom: 16px;
            width: 100%;
            box-sizing: border-box;
        }
        
        .upload-area:hover {
            border-color: #409EFF;
            background-color: #f0f9ff;
            box-shadow: 0 2px 8px rgba(64, 158, 255, 0.1);
        }
        
        .upload-area.dragover {
            border-color: #67c23a;
            background-color: #f0f9ff;
        }
        
        .upload-area input[type="file"] {
            display: none;
        }
        
        .upload-icon {
            font-size: 48px;
            color: #c0c4cc;
            margin-bottom: 12px;
            transition: color 0.3s ease;
        }
        
        .upload-area:hover .upload-icon {
            color: #409EFF;
        }
        
        .upload-text {
            font-size: 14px;
            color: #909399;
            line-height: 1.6;
        }
        
        .upload-text strong {
            color: #409EFF;
        }
        
        .upload-files {
            margin-top: 16px;
        }
        
        .upload-file {
            display: flex;
            align-items: center;
            padding: 12px;
            background-color: #f5f7fa;
            border-radius: 6px;
            margin-bottom: 8px;
            border: 1px solid #ebeef5;
            transition: all 0.3s ease;
        }
        
        .upload-file:hover {
            border-color: #dcdfe6;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
        }
        
        .file-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #409EFF;
            margin-right: 12px;
            background-color: white;
            border-radius: 4px;
            border: 1px solid #ebeef5;
        }
        
        .file-info {
            flex: 1;
            min-width: 0;
        }
        
        .file-name {
            font-size: 14px;
            color: #333;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .file-size {
            font-size: 12px;
            color: #909399;
            margin-bottom: 4px;
        }
        
        .file-progress {
            width: 100%;
            height: 4px;
            background-color: #ebeef5;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .file-progress-bar {
            height: 100%;
            background-color: #409EFF;
            transition: width 0.3s ease;
            border-radius: 2px;
        }
        
        .file-actions {
            display: flex;
            gap: 8px;
            margin-left: 12px;
        }
        
        .file-action-btn {
            padding: 6px 10px;
            border: none;
            background-color: #f5f7fa;
            cursor: pointer;
            font-size: 12px;
            color: #909399;
            border-radius: 4px;
            transition: all 0.3s ease;
            min-width: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .file-action-btn:hover {
            background-color: #409EFF;
            color: white;
        }
        
        .file-action-btn.danger:hover {
            background-color: #f56c6c;
        }
        
        .form-tips {
            font-size: 12px;
            color: #909399;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="publish-container">
        <div class="publish-header">
            <h2>å‘å¸ƒå…¬å‘Š</h2>
            <div class="header-actions">
                <button class="btn-secondary">ä¿å­˜è‰ç¨¿</button>
                <button class="btn-primary">å‘å¸ƒ</button>
            </div>
        </div>
        
        <form class="publish-form">
            <!-- åŸºæœ¬ä¿¡æ¯ -->
            <div class="form-section">
                <h3>åŸºæœ¬ä¿¡æ¯</h3>
                
                <div class="form-row">
                    <div class="form-item">
                        <label class="form-label required" for="announcement-type">å…¬å‘Šç±»å‹</label>
                        <select id="announcement-type" class="form-select">
                            <option value="">è¯·é€‰æ‹©å…¬å‘Šç±»å‹</option>
                            <option value="system">ç³»ç»Ÿå…¬å‘Š</option>
                            <option value="company">å…¬å¸å…¬å‘Š</option>
                            <option value="department">éƒ¨é—¨å…¬å‘Š</option>
                        </select>
                    </div>
                    
                    <div class="form-item">
                        <label class="form-label required" for="announcement-scope">å…¬å‘ŠèŒƒå›´</label>
                        <select id="announcement-scope" class="form-select">
                            <option value="">è¯·é€‰æ‹©å…¬å‘ŠèŒƒå›´</option>
                            <option value="all">å…¨ä½“å‘˜å·¥</option>
                            <option value="department">éƒ¨é—¨</option>
                            <option value="position">èŒä½</option>
                            <option value="custom">è‡ªå®šä¹‰</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-item full-width">
                        <label class="form-label required" for="announcement-title">å…¬å‘Šæ ‡é¢˜</label>
                        <input type="text" id="announcement-title" class="form-input" placeholder="è¯·è¾“å…¥å…¬å‘Šæ ‡é¢˜">
                        <div class="form-tips">æ ‡é¢˜é•¿åº¦å»ºè®®æ§åˆ¶åœ¨50å­—ä»¥å†…</div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-item">
                        <label class="form-label" for="effective-date">ç”Ÿæ•ˆæ—¥æœŸ</label>
                        <input type="date" id="effective-date" class="form-input">
                    </div>
                    
                    <div class="form-item">
                        <label class="form-label" for="expire-date">è¿‡æœŸæ—¥æœŸ</label>
                        <input type="date" id="expire-date" class="form-input">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-item">
                        <label class="form-label">å…¬å‘Šæ ‡ç­¾</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="tag-important" name="tags">
                                <label for="tag-important">é‡è¦</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="tag-top" name="tags">
                                <label for="tag-top">ç½®é¡¶</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- å…¬å‘Šå†…å®¹ -->
            <div class="form-section">
                <h3>å…¬å‘Šå†…å®¹</h3>
                
                <div class="form-row">
                    <div class="form-item full-width">
                        <label class="form-label required" for="announcement-content">å†…å®¹</label>
                        <textarea id="announcement-content" class="form-textarea" placeholder="è¯·è¾“å…¥å…¬å‘Šå†…å®¹"></textarea>
                        <div class="form-tips">æ”¯æŒå¸¸ç”¨HTMLæ ‡ç­¾ï¼Œå†…å®¹é•¿åº¦å»ºè®®æ§åˆ¶åœ¨5000å­—ä»¥å†…</div>
                    </div>
                </div>
            </div>
            
            <!-- é™„ä»¶ä¸Šä¼  -->
            <div class="form-section">
                <h3>é™„ä»¶ä¸Šä¼ </h3>
                
                <div class="form-row">
                    <div class="form-item full-width">
                        <label class="form-label">ä¸Šä¼ é™„ä»¶</label>
                        <div class="upload-wrapper">
                            <input type="file" id="file-upload" multiple style="display: none;">
                            <div id="upload-area" class="upload-placeholder">
                                <div class="upload-icon">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                        <polyline points="7 10 12 15 17 10" />
                                        <line x1="12" y1="15" x2="12" y2="3" />
                                    </svg>
                                </div>
                                <div class="upload-text">
                                    ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼ <br>
                                    <strong>æ”¯æŒæ ¼å¼ï¼š</strong>doc, docx, xls, xlsx, ppt, pptx, pdf, zip, rar<br>
                                    <strong>å•ä¸ªæ–‡ä»¶å¤§å°é™åˆ¶ï¼š</strong>50MB
                                </div>
                            </div>
                        </div>
                        
                        <div class="upload-files" id="uploaded-files">
                            <!-- ä¸Šä¼ çš„æ–‡ä»¶å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- å…¬å‘Šè®¾ç½® -->
            <div class="form-section">
                <h3>å…¬å‘Šè®¾ç½®</h3>
                
                <div class="form-row">
                    <div class="form-item">
                        <label class="form-label">æ˜¯å¦éœ€è¦ç¡®è®¤</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="need-confirm-yes" name="need-confirm" value="yes">
                                <label for="need-confirm-yes">æ˜¯</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="need-confirm-no" name="need-confirm" value="no" checked>
                                <label for="need-confirm-no">å¦</label>
                            </div>
                        </div>
                        <div class="form-tips">é€‰æ‹©"æ˜¯"æ—¶ï¼Œæ¥æ”¶è€…éœ€è¦ç¡®è®¤å·²é˜…è¯»å…¬å‘Š</div>
                    </div>
                    
                    <div class="form-item">
                        <label class="form-label">æ˜¯å¦çŸ­ä¿¡é€šçŸ¥</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="sms-notify-yes" name="sms-notify" value="yes">
                                <label for="sms-notify-yes">æ˜¯</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="sms-notify-no" name="sms-notify" value="no" checked>
                                <label for="sms-notify-no">å¦</label>
                            </div>
                        </div>
                        <div class="form-tips">é€‰æ‹©"æ˜¯"æ—¶ï¼Œå°†é€šè¿‡çŸ­ä¿¡é€šçŸ¥æ¥æ”¶è€…</div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-item">
                        <label class="form-label">æ˜¯å¦é‚®ä»¶é€šçŸ¥</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="email-notify-yes" name="email-notify" value="yes">
                                <label for="email-notify-yes">æ˜¯</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="email-notify-no" name="email-notify" value="no" checked>
                                <label for="email-notify-no">å¦</label>
                            </div>
                        </div>
                        <div class="form-tips">é€‰æ‹©"æ˜¯"æ—¶ï¼Œå°†é€šè¿‡é‚®ä»¶é€šçŸ¥æ¥æ”¶è€…</div>
                    </div>
                    
                    <div class="form-item">
                        <label class="form-label">æ˜¯å¦æ¨é€æ¶ˆæ¯</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="push-notify-yes" name="push-notify" value="yes">
                                <label for="push-notify-yes">æ˜¯</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="push-notify-no" name="push-notify" value="no" checked>
                                <label for="push-notify-no">å¦</label>
                            </div>
                        </div>
                        <div class="form-tips">é€‰æ‹©"æ˜¯"æ—¶ï¼Œå°†é€šè¿‡OAç³»ç»Ÿæ¶ˆæ¯æ¨é€é€šçŸ¥æ¥æ”¶è€…</div>
                    </div>
                </div>
            </div>
            
            <!-- è¡¨å•æ“ä½œ -->
            <div class="form-actions">
                <button type="button" class="btn-secondary" id="btn-cancel">å–æ¶ˆ</button>
                <button type="button" class="btn-secondary" id="btn-save">ä¿å­˜è‰ç¨¿</button>
                <button type="button" class="btn-primary" id="btn-publish">å‘å¸ƒ</button>
            </div>
        </form>
    </div>

    <script src="../JS/common.js"></script>
    <script src="../JS/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºå½“å¤©
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('effective-date').value = today;
            
            // æ–‡ä»¶ä¸Šä¼ å¤„ç†
            const fileUpload = document.getElementById('file-upload');
            const uploadedFiles = document.getElementById('uploaded-files');
            const uploadArea = document.getElementById('upload-area');
            
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œå½“ç‚¹å‡»ä¸Šä¼ åŒºåŸŸæ—¶è§¦å‘æ–‡ä»¶é€‰æ‹©
            uploadArea.addEventListener('click', function() {
                fileUpload.click();
            });
            
            // æ”¯æŒçš„æ–‡ä»¶ç±»å‹
            const SUPPORTED_FILE_TYPES = ['doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx', 'pdf', 'zip', 'rar'];
            const MAX_FILE_SIZE = 50 * 1024 * 1024; // 50MB
            
            // æ–‡ä»¶éªŒè¯å‡½æ•°
            function validateFile(file) {
                const fileExt = getFileExtension(file.name);
                
                // éªŒè¯æ–‡ä»¶ç±»å‹
                if (!SUPPORTED_FILE_TYPES.includes(fileExt)) {
                    showMessage(`ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼š${file.name}`, 'error');
                    return false;
                }
                
                // éªŒè¯æ–‡ä»¶å¤§å°
                if (file.size > MAX_FILE_SIZE) {
                    showMessage(`æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ï¼š${file.name} (æœ€å¤§50MB)`, 'error');
                    return false;
                }
                
                return true;
            }
            
            // æ·»åŠ æ–‡ä»¶åˆ°ä¸Šä¼ åˆ—è¡¨
            function addFileToUploadList(file) {
                const fileSize = formatFileSize(file.size);
                const fileExt = getFileExtension(file.name);
                const fileIcon = getFileIcon(fileExt);
                
                const fileItem = document.createElement('div');
                fileItem.className = 'upload-file';
                fileItem.innerHTML = `
                    <div class="file-icon">${fileIcon}</div>
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-size">${fileSize}</div>
                        <div class="file-progress">
                            <div class="file-progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="file-actions">
                        <button class="file-action-btn" title="é¢„è§ˆ">ğŸ‘ï¸</button>
                        <button class="file-action-btn danger" title="åˆ é™¤">ğŸ—‘ï¸</button>
                    </div>
                `;
                
                uploadedFiles.appendChild(fileItem);
                
                // æ·»åŠ åˆ é™¤æŒ‰é’®äº‹ä»¶
                const deleteBtn = fileItem.querySelector('.file-action-btn[title="åˆ é™¤"]');
                deleteBtn.addEventListener('click', function() {
                    fileItem.remove();
                    showMessage(`å·²åˆ é™¤æ–‡ä»¶ï¼š${file.name}`, 'success');
                });
                
                // æ·»åŠ é¢„è§ˆæŒ‰é’®äº‹ä»¶
                const previewBtn = fileItem.querySelector('.file-action-btn[title="é¢„è§ˆ"]');
                previewBtn.addEventListener('click', function() {
                    // å¯¹äºPDFç­‰æµè§ˆå™¨å¯é¢„è§ˆçš„æ–‡ä»¶ï¼Œå¯ä»¥å®ç°å®é™…é¢„è§ˆ
                    if (fileExt === 'pdf') {
                        const url = URL.createObjectURL(file);
                        window.open(url, '_blank');
                    } else {
                        showMessage(`é¢„è§ˆæ–‡ä»¶ï¼š${file.name}`, 'info');
                    }
                });
                
                // æ¨¡æ‹Ÿæ–‡ä»¶ä¸Šä¼ è¿›åº¦
                simulateFileUpload(fileItem, file.name);
            }
            
            // æ¨¡æ‹Ÿæ–‡ä»¶ä¸Šä¼ è¿›åº¦
            function simulateFileUpload(fileItem, fileName) {
                const progressBar = fileItem.querySelector('.file-progress-bar');
                let progress = 0;
                const interval = setInterval(() => {
                    progress += Math.random() * 20;
                    if (progress >= 100) {
                        progress = 100;
                        clearInterval(interval);
                        // ä¸Šä¼ å®Œæˆåå»¶è¿Ÿç§»é™¤è¿›åº¦æ¡
                        setTimeout(() => {
                            fileItem.querySelector('.file-progress').style.display = 'none';
                        }, 500);
                    }
                    progressBar.style.width = `${progress}%`;
                }, 300);
            }
            
            // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
            fileUpload.addEventListener('change', function(e) {
                const files = e.target.files;
                if (files.length > 0) {
                    const validFiles = Array.from(files).filter(validateFile);
                    
                    if (validFiles.length > 0) {
                        // æ·»åŠ æœ‰æ•ˆæ–‡ä»¶åˆ°åˆ—è¡¨
                        validFiles.forEach(file => {
                            addFileToUploadList(file);
                        });
                        
                        showMessage(`æˆåŠŸä¸Šä¼  ${validFiles.length} ä¸ªæ–‡ä»¶`, 'success');
                    }
                    
                    // æ¸…ç©ºinputå€¼ï¼Œä»¥ä¾¿å¯ä»¥é‡å¤ä¸Šä¼ ç›¸åŒçš„æ–‡ä»¶
                    this.value = '';
                }
            });
            
            // æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                uploadArea.classList.add('dragover');
            }
            
            function unhighlight() {
                uploadArea.classList.remove('dragover');
            }
            
            uploadArea.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length > 0) {
                    const validFiles = Array.from(files).filter(validateFile);
                    
                    if (validFiles.length > 0) {
                        // æ·»åŠ æœ‰æ•ˆæ–‡ä»¶åˆ°åˆ—è¡¨
                        validFiles.forEach(file => {
                            addFileToUploadList(file);
                        });
                        
                        showMessage(`æˆåŠŸä¸Šä¼  ${validFiles.length} ä¸ªæ–‡ä»¶`, 'success');
                    }
                }
            }
            
            // å–æ¶ˆæŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('btn-cancel').addEventListener('click', function() {
                confirmDialog('ç¡®å®šè¦å–æ¶ˆå‘å¸ƒå…¬å‘Šå—ï¼Ÿæœªä¿å­˜çš„å†…å®¹å°†ä¸¢å¤±ã€‚', function(confirm) {
                    if (confirm) {
                        window.location.href = 'announcement_list.html';
                    }
                });
            });
            
            // ä¿å­˜è‰ç¨¿æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('btn-save').addEventListener('click', function() {
                saveAnnouncement('draft');
            });
            
            // å‘å¸ƒæŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('btn-publish').addEventListener('click', function() {
                confirmDialog('ç¡®å®šè¦å‘å¸ƒæ­¤å…¬å‘Šå—ï¼Ÿå‘å¸ƒåå°†ç«‹å³é€šçŸ¥ç›¸å…³äººå‘˜ã€‚', function(confirm) {
                    if (confirm) {
                        saveAnnouncement('publish');
                    }
                });
            });
            
            // å…¬å‘ŠèŒƒå›´é€‰æ‹©å˜åŒ–äº‹ä»¶
            document.getElementById('announcement-scope').addEventListener('change', function() {
                const scope = this.value;
                if (scope === 'department' || scope === 'position' || scope === 'custom') {
                    showMessage(`å…¬å‘ŠèŒƒå›´è®¾ç½®ä¸ºï¼š${getOptionText('announcement-scope', scope)}ï¼Œè¯·è”ç³»ç®¡ç†å‘˜è¿›è¡Œè¯¦ç»†é…ç½®`, 'info');
                }
            });
            
            // è¾…åŠ©å‡½æ•°ï¼šä¿å­˜æˆ–å‘å¸ƒå…¬å‘Š
            function saveAnnouncement(type) {
                // è¡¨å•éªŒè¯
                if (!validateForm()) {
                    return;
                }
                
                // æ„å»ºå…¬å‘Šæ•°æ®
                const announcementData = {
                    type: document.getElementById('announcement-type').value,
                    scope: document.getElementById('announcement-scope').value,
                    title: document.getElementById('announcement-title').value,
                    effectiveDate: document.getElementById('effective-date').value,
                    expireDate: document.getElementById('expire-date').value,
                    content: document.getElementById('announcement-content').value,
                    tags: {
                        important: document.getElementById('tag-important').checked,
                        top: document.getElementById('tag-top').checked
                    },
                    settings: {
                        needConfirm: document.querySelector('input[name="need-confirm"]:checked').value === 'yes',
                        smsNotify: document.querySelector('input[name="sms-notify"]:checked').value === 'yes',
                        emailNotify: document.querySelector('input[name="email-notify"]:checked').value === 'yes',
                        pushNotify: document.querySelector('input[name="push-notify"]:checked').value === 'yes'
                    },
                    status: type === 'publish' ? 'published' : 'draft'
                };
                
                // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„ä¿å­˜é€»è¾‘
                console.log('å…¬å‘Šæ•°æ®ï¼š', announcementData);
                
                if (type === 'publish') {
                    showMessage('å…¬å‘Šå‘å¸ƒæˆåŠŸ', 'success');
                    setTimeout(function() {
                        window.location.href = 'announcement_list.html';
                    }, 1500);
                } else {
                    showMessage('å…¬å‘Šå·²ä¿å­˜ä¸ºè‰ç¨¿', 'success');
                }
            }
            
            // è¾…åŠ©å‡½æ•°ï¼šè¡¨å•éªŒè¯
            function validateForm() {
                const announcementType = document.getElementById('announcement-type').value;
                const announcementScope = document.getElementById('announcement-scope').value;
                const announcementTitle = document.getElementById('announcement-title').value.trim();
                const announcementContent = document.getElementById('announcement-content').value.trim();
                const effectiveDate = document.getElementById('effective-date').value;
                const expireDate = document.getElementById('expire-date').value;
                
                if (!announcementType) {
                    showMessage('è¯·é€‰æ‹©å…¬å‘Šç±»å‹', 'error');
                    return false;
                }
                
                if (!announcementScope) {
                    showMessage('è¯·é€‰æ‹©å…¬å‘ŠèŒƒå›´', 'error');
                    return false;
                }
                
                if (!announcementTitle) {
                    showMessage('è¯·è¾“å…¥å…¬å‘Šæ ‡é¢˜', 'error');
                    return false;
                }
                
                if (announcementTitle.length > 50) {
                    showMessage('å…¬å‘Šæ ‡é¢˜ä¸èƒ½è¶…è¿‡50ä¸ªå­—', 'error');
                    return false;
                }
                
                if (!announcementContent) {
                    showMessage('è¯·è¾“å…¥å…¬å‘Šå†…å®¹', 'error');
                    return false;
                }
                
                if (announcementContent.length > 5000) {
                    showMessage('å…¬å‘Šå†…å®¹ä¸èƒ½è¶…è¿‡5000ä¸ªå­—', 'error');
                    return false;
                }
                
                if (!effectiveDate) {
                    showMessage('è¯·é€‰æ‹©ç”Ÿæ•ˆæ—¥æœŸ', 'error');
                    return false;
                }
                
                if (expireDate && new Date(expireDate) < new Date(effectiveDate)) {
                    showMessage('è¿‡æœŸæ—¥æœŸä¸èƒ½æ—©äºç”Ÿæ•ˆæ—¥æœŸ', 'error');
                    return false;
                }
                
                return true;
            }
            
            // è¾…åŠ©å‡½æ•°ï¼šæ ¼å¼åŒ–æ–‡ä»¶å¤§å°
            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            // è¾…åŠ©å‡½æ•°ï¼šè·å–æ–‡ä»¶æ‰©å±•å
            function getFileExtension(filename) {
                return filename.split('.').pop().toLowerCase();
            }
            
            // è¾…åŠ©å‡½æ•°ï¼šæ ¹æ®æ–‡ä»¶æ‰©å±•åè·å–æ–‡ä»¶å›¾æ ‡
            function getFileIcon(ext) {
                const icons = {
                    doc: 'ğŸ“„',
                    docx: 'ğŸ“„',
                    xls: 'ğŸ“Š',
                    xlsx: 'ğŸ“Š',
                    ppt: 'ğŸ“‹',
                    pptx: 'ğŸ“‹',
                    pdf: 'ğŸ“',
                    zip: 'ğŸ—œï¸',
                    rar: 'ğŸ—œï¸'
                };
                return icons[ext] || 'ğŸ“';
            }
            
            // è¾…åŠ©å‡½æ•°ï¼šæ ¹æ®å€¼è·å–é€‰é¡¹æ–‡æœ¬
            function getOptionText(selectId, value) {
                const select = document.getElementById(selectId);
                const option = select.querySelector(`option[value="${value}"]`);
                return option ? option.textContent : value;
            }
        });
    </script>
</body>
</html>